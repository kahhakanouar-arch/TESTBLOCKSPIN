-- Ton propre AUTO ATM FARM simple pour BlockSpin (custom Grok 21/02/2026)
-- Fonctionne sur Xeno si level 8 OK (hookfunction, getgc, RunService)
-- Active près d'ATMs, loop hack nearest

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local root = char:WaitForChild("HumanoidRootPart")

-- 1. AC Bypass basique (hook wellbeing)
local function bypassAC()
    for _, v in pairs(getgc(true)) do
        if typeof(v) == "function" and debug.getinfo(v).source and debug.getinfo(v).source:find("PlayerWellbeingObfuscated") then
            pcall(function()
                hookfunction(v, function(...) return task.wait(999999) end)
            end)
        end
    end
    print("[CUSTOM] AC Bypass activé !")
end
bypassAC()

-- 2. Trouver nearest ATM (via proximité)
local function getNearestATM()
    local nearest, dist = nil, math.huge
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("ATM") or (obj.Name:lower():find("atm") and obj:IsA("BasePart")) then
            local pos = obj:IsA("BasePart") and obj.Position or obj.PrimaryPart.Position
            local d = (root.Position - pos).Magnitude
            if d < dist then
                nearest = obj
                dist = d
            end
        end
    end
    return nearest
end

-- 3. Auto perfect slider hack (timing sur vert)
-- Assume le minigame est dans PlayerGui ou CoreGui après hack start
local function autoSliderPerfect()
    local connection
    connection = RunService.Heartbeat:Connect(function()
        -- Cherche le slider GUI (adapte si nom change)
        local gui = player.PlayerGui:FindFirstChild("SliderMinigame") or player.PlayerGui:FindFirstChildWhichIsA("ScreenGui", true)
        if gui then
            -- Cherche le "green bar" ou indicator (typique slider)
            local green = gui:FindFirstChild("Green", true) or gui:FindFirstChild("SuccessZone", true)
            if green and green.Visible and green:IsA("Frame") then
                -- Spoof click ou fire remote au bon moment (position milieu vert)
                local center = green.AbsolutePosition + green.AbsoluteSize/2
                -- Simule mouse click (via VirtualUser ou remote si possible)
                -- Alternative: fire le remote "complete_minigame" avec value perfect
                local net = require(ReplicatedStorage.Modules.Core.Net)
                if net then
                    net.send("complete_slider", 1)  -- 1 = success, adapte si arg diff
                    print("[CUSTOM] Perfect hit simulé !")
                end
                connection:Disconnect()
            end
        end
    end)
    task.delay(10, function() if connection then connection:Disconnect() end end) -- timeout
end

-- 4. Main loop farm
getgenv().autoFarmATM = true
spawn(function()
    while getgenv().autoFarmATM do
        local atm = getNearestATM()
        if atm and (root.Position - atm.PrimaryPart.Position).Magnitude < 15 then
            print("[CUSTOM] ATM trouvé proche ! Hack...")
            
            -- Trigger hack (fire remote ATM start)
            local atmMod = ReplicatedStorage.Modules.Game.ATM
            if atmMod then
                local net = require(ReplicatedStorage.Modules.Core.Net)
                net.send("start_atm_hack", atm)  -- adapte arg si besoin (atm instance ou id)
            end
            
            task.wait(1)  -- wait minigame pop
            autoSliderPerfect()  -- auto perfect vert
            task.wait(5)  -- wait cash + cooldown
        else
            print("[CUSTOM] Pas d'ATM proche... bouge-toi !")
            task.wait(3)
        end
        task.wait(1)
    end
end)

print("[CUSTOM SCRIPT] AUTO ATM lancé ! Toggle avec getgenv().autoFarmATM = false")
game.StarterGui:SetCore("SendNotification", {Title="Ton Custom ATM Farm", Text="Loop ON - Va près ATM !", Duration=5})
